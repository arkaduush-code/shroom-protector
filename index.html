<!DOCTYPE html>
<html>
<head>
    <title>The Shroom Protector</title>
    <meta name="x-ogp-key" content="657c89e6-1d39-472f-aa21-b6ef8dc732ff" id="ogp-key-meta" />
    
    <style>
        body { margin: 0; background-color: #020202; color: #00ffcc; font-family: 'Courier New', Courier, monospace; text-align: center; overflow: hidden; }
        .header-container { display: flex; justify-content: center; align-items: center; gap: 20px; margin-top: 10px; margin-bottom: 5px; }
        .header-logo { font-size: 35px; text-shadow: 0px 0px 20px #00ffcc; filter: drop-shadow(0px 0px 10px rgba(0, 255, 204, 0.8)); }
        h2 { margin: 0; color: #00ffcc; letter-spacing: 4px; text-shadow: 0px 0px 15px #00ffcc; font-size: 30px;}
        #gameHUD { display: flex; justify-content: space-between; align-items: center; width: 1200px; margin: 5px auto; font-size: 18px; font-weight: bold; color: #00ffcc; text-shadow: 0px 0px 10px #00ffcc; }
        
        .hp-container { width: 300px; height: 25px; border: 2px solid #fff; border-radius: 5px; background: #330000; position: relative; overflow: hidden;}
        #hpFill { height: 100%; width: 100%; background: #00ff00; transition: width 0.2s, background-color 0.2s; box-shadow: 0px 0px 10px #00ff00; }
        .hp-text { position: absolute; top: 2px; left: 0; width: 100%; text-align: center; color: white; font-size: 16px; text-shadow: 1px 1px 2px black; z-index: 2; }

        .game-wrapper { position: relative; width: 1200px; height: 750px; margin: 0 auto; border: 3px solid #00ffcc; border-radius: 10px; box-shadow: 0px 0px 60px rgba(0, 255, 204, 0.4); overflow: hidden; background-color: #050508; }
        canvas { display: block; }
        .scanlines { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06)); background-size: 100% 4px, 3px 100%; pointer-events: none; z-index: 10; }
        
        /* START AND OVERLAYS */
        #startScreen, #gameOverScreen { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0, 0, 0, 0.9); padding: 50px; border: 2px solid #00ffcc; border-radius: 10px; box-shadow: 0px 0px 50px #00ffcc; z-index: 20; }
        #gameOverScreen { display: none; border-color: #ff0000; box-shadow: 0px 0px 50px #ff0000; }

        .command-guide { width: 1200px; margin: 10px auto; padding: 10px; border: 1px solid #00ffcc; background: rgba(0, 255, 204, 0.1); border-radius: 5px; color: #fff; font-size: 16px; display: flex; justify-content: space-around; text-shadow: 0px 0px 5px #00ffcc;}
        .highlight { color: #ff00ff; font-weight: bold; text-shadow: 0px 0px 8px #ff00ff;}

        .btn { background-color: #00ffcc; color: black; border: none; padding: 15px 30px; font-size: 20px; cursor: pointer; border-radius: 5px; font-weight: bold; margin-top: 15px; }
        .btn:hover { background-color: #00ccaa; }
        #modeDisplay { background-color: #00ffcc; color: black; padding: 5px 15px; font-size: 16px; border-radius: 5px; font-weight: bold; box-shadow: 0px 0px 15px #00ffcc; min-width: 250px; }
        #modeDisplay.manual { background-color: #ff00ff; box-shadow: 0px 0px 15px #ff00ff; color: white; }
    </style>
</head>
<body>

    <div class="header-container">
        <div class="header-logo">üëΩüçÑ</div>
        <h2>THE SHROOM PROTECTOR</h2>
        <div class="header-logo">üçÑüëΩ</div>
    </div>

    <div id="gameHUD">
        <div id="scoreDisplay">Score: 0</div>
        <div class="hp-container"><div id="hpFill"></div><div class="hp-text" id="hpText">HULL INTEGRITY: 100%</div></div>
        <div id="modeDisplay">ü§ñ AUTO</div>
        <div id="bombDisplay">üí• Bombs: 1</div>
        <div id="levelDisplay">Level: 1</div>
    </div>

    <div class="game-wrapper">
        <div class="scanlines"></div>
        <canvas id="gameCanvas" width="1200" height="750"></canvas>

        <div id="startScreen">
            <h1 style="color: #00ffcc; margin-top: 0;">DEFEND THE CORE</h1>
            <p style="color: white;">Prepare for alien invasion.</p>
            <button class="btn" onclick="initGame()">START DEFENSE</button>
        </div>

        <div id="gameOverScreen">
            <h1 id="endTitle" style="color: red; font-size: 45px; margin-top: 0; text-shadow: 0px 0px 20px red;">HULL DESTROYED</h1>
            <p style="color: white; font-size: 24px;">Final Score: <span id="finalScore">0</span></p>
            <button class="btn" style="background: red; color: white;" onclick="restartGame()">REBOOT SYSTEM</button>
        </div>
    </div>

    <div class="command-guide">
        <span><span class="highlight">MODE TOGGLE:</span> 'M' for Manual / 'A' for Auto</span>
        <span><span class="highlight">MOVEMENT:</span> Arrow Keys</span>
        <span><span class="highlight">ATTACK:</span> Spacebar</span>
        <span><span class="highlight">BOMB:</span> 'B' (Manual Only)</span>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const levelDisplay = document.getElementById('levelDisplay');
        const bombDisplay = document.getElementById('bombDisplay');
        const modeDisplay = document.getElementById('modeDisplay');
        const startScreen = document.getElementById('startScreen');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const finalScore = document.getElementById('finalScore');
        const hpFill = document.getElementById('hpFill');
        const hpText = document.getElementById('hpText');

        let animationId, score = 0, level = 1, bombs = 1, isGameOver = false, isSpawning = false, isAutoMode = true, gameStarted = false;
        let lastShotTime = 0, lastHeadRocketTime = 0;
        let bossAlertText = "", bossAlertTimer = 0;

        const player = { x: canvas.width / 2, y: canvas.height - 90, speed: 15, hp: 100, maxHp: 100, invulnTimer: 0 };
        const keys = { ArrowLeft: false, ArrowRight: false, Space: false };
        
        window.addEventListener('keydown', (e) => {
            if (e.code === 'ArrowLeft') keys.ArrowLeft = true;
            if (e.code === 'ArrowRight') keys.ArrowRight = true;
            if (e.code === 'Space') { keys.Space = true; e.preventDefault(); }
            if ((e.code === 'KeyB' || e.key === 'b') && !isAutoMode) useBomb();
            if (e.code === 'KeyM' || e.key === 'm') setManualMode();
            if (e.code === 'KeyA' || e.key === 'a') setAutoMode();
        });
        window.addEventListener('keyup', (e) => {
            if (e.code === 'ArrowLeft') keys.ArrowLeft = false;
            if (e.code === 'ArrowRight') keys.ArrowRight = false;
            if (e.code === 'Space') keys.Space = false;
        });

        function setManualMode() { isAutoMode = false; modeDisplay.innerText = "üïπÔ∏è MANUAL"; modeDisplay.classList.add('manual'); }
        function setAutoMode() { isAutoMode = true; modeDisplay.innerText = "ü§ñ AUTO"; modeDisplay.classList.remove('manual'); }

        function updateHP() {
            let pct = Math.max(0, (player.hp / player.maxHp) * 100);
            hpFill.style.width = pct + "%";
            hpText.innerText = `HULL INTEGRITY: ${Math.ceil(pct)}%`;
            if (pct > 60) hpFill.style.background = "#00ff00";
            else if (pct > 30) hpFill.style.background = "#ffff00";
            else hpFill.style.background = "#ff0000";
            if (player.hp <= 0 && !isGameOver) endGame();
        }

        const levelColors = ['#00FF00', '#00FA33', '#00F566', '#00F099', '#00EBCC', '#00D6FF', '#00A3FF', '#0070FF', '#3333FF', '#6600FF', '#9900FF', '#CC00FF', '#FF00FF', '#FF00CC', '#FF0099', '#FF0066', '#FF0033', '#FF0000', '#CC0000', '#8B0000'];
        let projectiles = [], enemies = [], bossProjectiles = [], particles = [], activeBoss = null, screenShake = 0, stars = [];
        for (let i = 0; i < 200; i++) stars.push({ x: Math.random() * canvas.width, y: Math.random() * canvas.height, radius: Math.random() * 2 + 0.5, speed: Math.random() * 3 + 0.5, alpha: Math.random() });

        function createExplosion(x, y, color, amount) {
            for(let i=0; i<amount; i++) {
                particles.push({ x: x, y: y, vx: (Math.random() - 0.5) * 15, vy: (Math.random() - 0.5) * 15, life: 1.0, color: color, size: Math.random() * 5 + 2 });
            }
        }

        function useBomb() {
            if (bombs > 0 && gameStarted && !isGameOver) {
                bombs--; bombDisplay.innerText = `üí• Bombs: ${bombs}`;
                enemies = []; bossProjectiles = [];
                if (activeBoss) activeBoss.hp -= 1500;
                ctx.fillStyle = "white"; ctx.fillRect(0, 0, canvas.width, canvas.height);
                checkLevelComplete();
            }
        }

        function shoot() {
            let beamWidth = 8 + (level * 2);
            let beamColor = levelColors[Math.min(level - 1, 19)];
            projectiles.push({ type: 'laser', x: player.x, y: player.y - 40, width: beamWidth, height: 60, color: beamColor, velocityX: 0, velocityY: -25, damage: 25 + (level * 10) });
            if (level >= 5) {
                projectiles.push({ type: 'heavy_rocket', x: player.x, y: player.y - 80, width: 18, height: 45, color: '#FFFFFF', velocityX: 0, velocityY: -15, damage: 400 + (level * 50) });
            }
        }

        const bossData = {
            3: { name: "SLUDGE MOUTH", hp: 2000, color: "#4a5d23", shape: "blob", atkRate: 2000, speed: 0.3 },
            6: { name: "CRIMSON WATCHER", hp: 4500, color: "#8B0000", shape: "diamond", atkRate: 1500, speed: 0.4 },
            20: { name: "MOTHERSHIP OMEGA", hp: 50000, color: "#cccccc", shape: "ufo", atkRate: 300, speed: 0.3 }
        };

        function spawnWave() {
            isSpawning = true;
            if (level % 3 === 0 || level === 20) {
                let b = bossData[level] || bossData[3];
                activeBoss = { ...b, x: canvas.width/2, y: -250, maxHp: b.hp, time: 0, lastAtk: Date.now(), width: 200, height: 150 };
                bossAlertText = activeBoss.name; bossAlertTimer = 150;
            } else {
                for (let i = 0; i < 6 + (level * 4); i++) enemies.push({ x: Math.random() * 1100 + 50, y: Math.random() * -1000 - 50, radius: 22, speed: 1.5 + (level * 0.2) });
            }
            isSpawning = false;
        }

        function drawPlayer() {
            let size = 25 + (Math.min(level, 20) * 2.5);
            ctx.fillStyle = levelColors[Math.min(level - 1, 19)];
            ctx.beginPath(); ctx.arc(player.x, player.y, size, 0, Math.PI * 2); ctx.fill();
        }

        function animate() {
            if (isGameOver) return;
            animationId = requestAnimationFrame(animate);
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            stars.forEach(s => { s.y += s.speed; if (s.y > canvas.height) s.y = 0; ctx.fillStyle = "white"; ctx.fillRect(s.x, s.y, s.radius, s.radius); });
            
            if (isAutoMode && enemies.length > 0) {
                let t = enemies[0];
                if (player.x < t.x) player.x += player.speed; else player.x -= player.speed;
                if (Date.now() - lastShotTime > 150) { shoot(); lastShotTime = Date.now(); }
            } else if (!isAutoMode) {
                if (keys.ArrowLeft) player.x -= player.speed; if (keys.ArrowRight) player.x += player.speed;
                if (keys.Space && Date.now() - lastShotTime > 150) { shoot(); lastShotTime = Date.now(); }
            }

            enemies.forEach((e, i) => {
                e.y += e.speed; ctx.font = "40px Arial"; ctx.fillText("üëΩ", e.x, e.y);
                if (e.y > canvas.height) { player.hp -= 10; enemies.splice(i, 1); updateHP(); checkLevelComplete(); }
            });

            projectiles.forEach((p, i) => {
                p.y += p.velocityY; ctx.fillStyle = p.color; ctx.fillRect(p.x, p.y, p.width, p.height);
                enemies.forEach((e, ei) => { if (Math.hypot(p.x - e.x, p.y - e.y) < 30) { enemies.splice(ei, 1); projectiles.splice(i, 1); score += 10; scoreDisplay.innerText = "Score: " + score; checkLevelComplete(); } });
            });
            drawPlayer();
        }

        function checkLevelComplete() { if (enemies.length === 0 && !activeBoss && !isSpawning) { level++; levelDisplay.innerText = "Level: " + level; spawnWave(); } }
        function initGame() { gameStarted = true; startScreen.style.display = 'none'; spawnWave(); animate(); }
        function endGame() { isGameOver = true; gameOverScreen.style.display = 'block'; finalScore.innerText = score; }
        function restartGame() { location.reload(); }
    </script>
</body>
</html>
