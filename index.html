<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>The Shroom Protector</title>
    <meta name="x-ogp-key" content="657c89e6-1d39-472f-aa21-b6ef8dc732ff" id="ogp-key-meta" />
    
    <style>
        body { margin: 0; background-color: #020202; color: #00ffcc; font-family: 'Courier New', Courier, monospace; text-align: center; overflow: hidden; }
        .header-container { display: flex; justify-content: center; align-items: center; gap: 20px; margin-top: 10px; margin-bottom: 5px; }
        h2 { margin: 0; color: #00ffcc; letter-spacing: 4px; text-shadow: 0px 0px 15px #00ffcc; font-size: 30px;}
        
        #gameHUD { display: flex; justify-content: space-between; align-items: center; width: 1200px; margin: 5px auto; font-size: 18px; font-weight: bold; color: #00ffcc; text-shadow: 0px 0px 10px #00ffcc; }
        .hp-container { width: 300px; height: 25px; border: 2px solid #fff; border-radius: 5px; background: #330000; position: relative; overflow: hidden;}
        #hpFill { height: 100%; width: 100%; background: #00ff00; transition: width 0.2s; box-shadow: 0px 0px 10px #00ff00; }
        .hp-text { position: absolute; top: 2px; left: 0; width: 100%; text-align: center; color: white; font-size: 16px; z-index: 2; }

        .game-wrapper { position: relative; width: 1200px; height: 750px; margin: 0 auto; border: 3px solid #00ffcc; border-radius: 10px; box-shadow: 0px 0px 60px rgba(0, 255, 204, 0.4); overflow: hidden; background-color: #050508; }
        canvas { display: block; }
        
        /* OVERLAYS */
        #startScreen, #gameOverScreen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100; }
        #gameOverScreen { display: none; }
        .btn-main { background: #00ffcc; color: #000; border: none; padding: 25px 50px; font-size: 30px; font-weight: bold; cursor: pointer; border-radius: 10px; box-shadow: 0 0 25px #00ffcc; transition: 0.3s; }
        .btn-main:hover { transform: scale(1.1); background: #fff; }

        .command-guide { width: 1200px; margin: 10px auto; padding: 10px; border: 1px solid #00ffcc; background: rgba(0, 255, 204, 0.1); border-radius: 5px; color: #fff; font-size: 16px; display: flex; justify-content: space-around; }
        .highlight { color: #ff00ff; font-weight: bold; text-shadow: 0px 0px 8px #ff00ff;}
        #musicBtn { position: absolute; top: 10px; left: 10px; z-index: 110; background: rgba(0,255,204,0.2); color: #00ffcc; border: 1px solid #00ffcc; padding: 10px; cursor: pointer; border-radius: 5px; }
    </style>
</head>
<body>

    <button id="musicBtn" onclick="toggleMusic()">ðŸ”Š MUSIC: ON</button>

    <div class="header-container">
        <h2>THE SHROOM PROTECTOR</h2>
    </div>

    <div id="gameHUD">
        <div id="scoreDisplay">Score: 0</div>
        <div class="hp-container"><div id="hpFill"></div><div class="hp-text">HULL INTEGRITY: 100%</div></div>
        <div id="levelDisplay">Level: 1</div>
    </div>

    <div class="game-wrapper">
        <canvas id="gameCanvas" width="1200" height="750"></canvas>

        <div id="startScreen">
            <h1 style="color: #00ffcc; font-size: 60px; text-shadow: 0 0 30px #00ffcc; margin-bottom: 10px;">SYSTEM INITIALIZED</h1>
            <p style="color: white; font-size: 20px; margin-bottom: 30px;">Electronic Score Produced by Arkadiusz</p>
            <button class="btn-main" onclick="beginDefense()">START DEFENSE</button>
        </div>

        <div id="gameOverScreen">
            <h1 style="color: red; font-size: 50px; text-shadow: 0 0 20px red;">HULL BREACHED</h1>
            <p style="color: white; font-size: 24px;">Final Score: <span id="finalScore">0</span></p>
            <button class="btn-main" style="background: red; color: white;" onclick="location.reload()">REBOOT SYSTEM</button>
        </div>
    </div>

    <div class="command-guide">
        <span><span class="highlight">MODE:</span> 'M' Manual / 'A' Auto</span>
        <span><span class="highlight">MOVE:</span> Arrow Keys</span>
        <span><span class="highlight">FIRE:</span> Spacebar</span>
        <span><span class="highlight">BOMB:</span> 'B' Key</span>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const bgMusic = new Audio('track1.mp3'); 
        bgMusic.loop = true;
        let musicOn = true;

        let score = 0, level = 1, isGameOver = false, gameRunning = false, isAutoMode = true;
        let player = { x: 600, y: 660, hp: 100, speed: 15 };
        let enemies = [], projectiles = [], lastShot = 0, stars = [];
        const keys = { ArrowLeft: false, ArrowRight: false, Space: false };

        window.addEventListener('keydown', (e) => { 
            if(keys.hasOwnProperty(e.code)) keys[e.code] = true; 
            if(e.code === 'KeyM') isAutoMode = false;
            if(e.code === 'KeyA') isAutoMode = true;
            if(e.code === 'KeyB' && !isAutoMode) triggerBomb();
        });
        window.addEventListener('keyup', (e) => { if(keys.hasOwnProperty(e.code)) keys[e.code] = false; });

        function toggleMusic() {
            musicOn = !musicOn;
            if(musicOn) { bgMusic.play(); document.getElementById('musicBtn').innerText = "ðŸ”Š MUSIC: ON"; }
            else { bgMusic.pause(); document.getElementById('musicBtn').innerText = "ðŸ”‡ MUSIC: OFF"; }
        }

        function triggerBomb() {
            if(enemies.length > 0) {
                enemies = [];
                score += 500;
                document.getElementById('scoreDisplay').innerText = "Score: " + score;
            }
        }

        function beginDefense() {
            document.getElementById('startScreen').style.display = 'none';
            gameRunning = true;
            bgMusic.play().catch(() => console.log("Music waiting for interaction..."));
            spawnEnemies();
            for (let i = 0; i < 150; i++) stars.push({x: Math.random()*1200, y: Math.random()*750, s: Math.random()*2});
            gameLoop();
        }

        function spawnEnemies() {
            if(!gameRunning || isGameOver) return;
            for(let i=0; i < 6 + (level * 2); i++) {
                enemies.push({x: Math.random()*1100 + 50, y: Math.random()*-800, spd: 1.5 + (level*0.3)});
            }
        }

        function gameLoop() {
            if(!gameRunning || isGameOver) return;
            ctx.clearRect(0,0,1200,750);
            
            stars.forEach(s => { s.y += s.s; if(s.y > 750) s.y = 0; ctx.fillStyle="white"; ctx.fillRect(s.x, s.y, 1, 1); });

            if(isAutoMode && enemies.length > 0) {
                let target = enemies[0];
                if(player.x < target.x) player.x += player.speed; else player.x -= player.speed;
                if(Date.now() - lastShot > 150) { projectiles.push({x: player.x, y: player.y-30}); lastShot = Date.now(); }
            } else if(!isAutoMode) {
                if(keys.ArrowLeft && player.x > 50) player.x -= player.speed;
                if(keys.ArrowRight && player.x < 1150) player.x += player.speed;
                if(keys.Space && Date.now() - lastShot > 150) { projectiles.push({x: player.x, y: player.y-30}); lastShot = Date.now(); }
            }

            // Draw Player Mushroom
            ctx.fillStyle = "#00ffcc"; ctx.beginPath(); ctx.arc(player.x, player.y, 35, 0, Math.PI*2); ctx.fill();

            projectiles.forEach((p, pi) => {
                p.y -= 15; ctx.fillStyle="yellow"; ctx.fillRect(p.x-2, p.y, 4, 20);
                enemies.forEach((e, ei) => {
                    if(Math.hypot(p.x-e.x, p.y-e.y) < 35) { enemies.splice(ei, 1); projectiles.splice(pi, 1); score += 20; document.getElementById('scoreDisplay').innerText = "Score: " + score; }
                });
            });

            enemies.forEach((e, ei) => {
                e.y += e.spd; ctx.font = "45px Arial"; ctx.fillText("ðŸ‘½", e.x, e.y);
                if(e.y > 750) { player.hp -= 15; enemies.splice(ei, 1); document.getElementById('hpFill').style.width = Math.max(0, player.hp) + "%"; }
            });

            if(player.hp <= 0) { 
                isGameOver = true; 
                document.getElementById('gameOverScreen').style.display = 'flex'; 
                document.getElementById('finalScore').innerText = score;
            }
            if(enemies.length === 0) { level++; document.getElementById('levelDisplay').innerText = "Level: " + level; spawnEnemies(); }
            requestAnimationFrame(gameLoop);
        }
    </script>
</body>
</html>
